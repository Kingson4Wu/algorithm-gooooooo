package topinterview145

import (
	"fmt"
	"sort"
	"testing"
)

/**
åŸå¸‚çš„ å¤©é™…çº¿ æ˜¯ä»è¿œå¤„è§‚çœ‹è¯¥åŸå¸‚ä¸­æ‰€æœ‰å»ºç­‘ç‰©å½¢æˆçš„è½®å»“çš„å¤–éƒ¨è½®å»“ã€‚ç»™ä½ æ‰€æœ‰å»ºç­‘ç‰©çš„ä½ç½®å’Œé«˜åº¦ï¼Œè¯·è¿”å› ç”±è¿™äº›å»ºç­‘ç‰©å½¢æˆçš„ å¤©é™…çº¿ ã€‚

æ¯ä¸ªå»ºç­‘ç‰©çš„å‡ ä½•ä¿¡æ¯ç”±æ•°ç»„ buildings è¡¨ç¤ºï¼Œå…¶ä¸­ä¸‰å…ƒç»„ buildings[i] = [lefti, righti, heighti] è¡¨ç¤ºï¼š

lefti æ˜¯ç¬¬ i åº§å»ºç­‘ç‰©å·¦è¾¹ç¼˜çš„ x åæ ‡ã€‚
righti æ˜¯ç¬¬ i åº§å»ºç­‘ç‰©å³è¾¹ç¼˜çš„ x åæ ‡ã€‚
heighti æ˜¯ç¬¬ i åº§å»ºç­‘ç‰©çš„é«˜åº¦ã€‚
ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„å»ºç­‘éƒ½æ˜¯å®Œç¾çš„é•¿æ–¹å½¢ï¼Œåœ¨é«˜åº¦ä¸º 0 çš„ç»å¯¹å¹³å¦çš„è¡¨é¢ä¸Šã€‚

å¤©é™…çº¿ åº”è¯¥è¡¨ç¤ºä¸ºç”± â€œå…³é”®ç‚¹â€ ç»„æˆçš„åˆ—è¡¨ï¼Œæ ¼å¼ [[x1,y1],[x2,y2],...] ï¼Œå¹¶æŒ‰ x åæ ‡ è¿›è¡Œ æ’åº ã€‚å…³é”®ç‚¹æ˜¯æ°´å¹³çº¿æ®µçš„å·¦ç«¯ç‚¹ã€‚åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªç‚¹æ˜¯æœ€å³ä¾§å»ºç­‘ç‰©çš„ç»ˆç‚¹ï¼Œy åæ ‡å§‹ç»ˆä¸º 0 ï¼Œä»…ç”¨äºæ ‡è®°å¤©é™…çº¿çš„ç»ˆç‚¹ã€‚æ­¤å¤–ï¼Œä»»ä½•ä¸¤ä¸ªç›¸é‚»å»ºç­‘ç‰©ä¹‹é—´çš„åœ°é¢éƒ½åº”è¢«è§†ä¸ºå¤©é™…çº¿è½®å»“çš„ä¸€éƒ¨åˆ†ã€‚

æ³¨æ„ï¼šè¾“å‡ºå¤©é™…çº¿ä¸­ä¸å¾—æœ‰è¿ç»­çš„ç›¸åŒé«˜åº¦çš„æ°´å¹³çº¿ã€‚ä¾‹å¦‚ [...[2 3], [4 5], [7 5], [11 5], [12 7]...] æ˜¯ä¸æ­£ç¡®çš„ç­”æ¡ˆï¼›ä¸‰æ¡é«˜åº¦ä¸º 5 çš„çº¿åº”è¯¥åœ¨æœ€ç»ˆè¾“å‡ºä¸­åˆå¹¶ä¸ºä¸€ä¸ªï¼š[...[2 3], [4 5], [12 7], ...]



ç¤ºä¾‹ 1ï¼š


è¾“å…¥ï¼šbuildings = [[2,9,10],[3,7,15],[5,12,12],[15,20,10],[19,24,8]]
è¾“å‡ºï¼š[[2,10],[3,15],[7,12],[12,0],[15,10],[20,8],[24,0]]
è§£é‡Šï¼š
å›¾ A æ˜¾ç¤ºè¾“å…¥çš„æ‰€æœ‰å»ºç­‘ç‰©çš„ä½ç½®å’Œé«˜åº¦ï¼Œ
å›¾ B æ˜¾ç¤ºç”±è¿™äº›å»ºç­‘ç‰©å½¢æˆçš„å¤©é™…çº¿ã€‚å›¾ B ä¸­çš„çº¢ç‚¹è¡¨ç¤ºè¾“å‡ºåˆ—è¡¨ä¸­çš„å…³é”®ç‚¹ã€‚
ç¤ºä¾‹ 2ï¼š

è¾“å…¥ï¼šbuildings = [[0,2,3],[2,5,3]]
è¾“å‡ºï¼š[[0,3],[5,0]]


æç¤ºï¼š

1 <= buildings.length <= 104
0 <= lefti < righti <= 231 - 1
1 <= heighti <= 231 - 1
buildings æŒ‰ lefti éé€’å‡æ’åº
*/
/**
æ ¸å¿ƒæ€è·¯ï¼šæ‰«æçº¿ + æœ€å¤§å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰

æ­¥éª¤è§£æï¼š
1. æŠŠæ‰€æœ‰â€œå…³é”®ç‚¹â€æå–å‡ºæ¥
æ¯ä¸ªå»ºç­‘å¯ä»¥è½¬åŒ–ä¸ºä¸¤ä¸ªäº‹ä»¶ï¼š
	- å·¦è¾¹ç•Œï¼šè¡¨ç¤ºå»ºç­‘å¼€å§‹ left, -heightï¼ˆè´Ÿå·è¡¨ç¤ºè¿›å…¥ï¼‰
	- å³è¾¹ç•Œï¼šè¡¨ç¤ºå»ºç­‘ç»“æŸ right, heightï¼ˆæ­£å·è¡¨ç¤ºç¦»å¼€ï¼‰
ğŸ‘‰ ä¸ºä»€ä¹ˆå·¦è¾¹é«˜åº¦å–è´Ÿï¼Ÿè¿™æ ·æ–¹ä¾¿åœ¨æ’åºæ—¶ï¼š
	- ç›¸åŒ x æ—¶ï¼Œè¿›å…¥å»ºç­‘ä¼˜å…ˆäºç¦»å¼€å»ºç­‘
	- è¿›å…¥æ—¶é«˜åº¦å¤§çš„ä¼˜å…ˆï¼ˆè´Ÿæ•°æ›´å°ï¼‰
2. æŒ‰ x ä»å°åˆ°å¤§æ’åºè¿™äº›å…³é”®ç‚¹
3. ç”¨ä¸€ä¸ªæœ€å¤§å †ç»´æŠ¤å½“å‰æ‰€æœ‰è¿˜æ²¡ç»“æŸçš„å»ºç­‘çš„é«˜åº¦
	- è¿›å…¥ç‚¹ï¼šæŠŠé«˜åº¦åŠ å…¥å †
	- ç¦»å¼€ç‚¹ï¼šä»å †ä¸­ç§»é™¤è¯¥é«˜åº¦
4. æ¯æ¬¡é«˜åº¦å˜åŒ–ï¼Œå°±è®°å½•ä¸€ä¸ªå…³é”®ç‚¹
	- å½“å‰æœ€å¤§é«˜åº¦ != ä¸Šä¸€æ¬¡æœ€å¤§é«˜åº¦ï¼Œå°±è¯´æ˜ skyline æœ‰å˜åŒ–
	- è®°å½•å½“å‰ x åæ ‡å’Œå½“å‰å †é¡¶ï¼ˆæœ€å¤§é«˜åº¦ï¼‰

ğŸ“Œ å°ç»“
æ­¥éª¤	å†…å®¹
1	æŠŠå»ºç­‘è½¬ä¸ºå…³é”®ç‚¹ï¼šè¿›å…¥ç‚¹ï¼ˆè´Ÿé«˜ï¼‰å’Œç¦»å¼€ç‚¹ï¼ˆæ­£é«˜ï¼‰
2	æ’åºè§„åˆ™ï¼šå…ˆæŒ‰æ¨ªåæ ‡ï¼Œå†æŒ‰é«˜åº¦ï¼ˆè´Ÿæ•°åœ¨å‰ï¼‰
3	æ‰«æçº¿+æœ€å¤§å †ç»´æŠ¤å½“å‰é«˜åº¦
4	å¦‚æœå½“å‰æœ€å¤§é«˜åº¦å˜äº† â†’ è®°å½•å…³é”®ç‚¹

*/
/**
çœ‹å®Œé¢˜è§£è‡ªå·±æ¥å®ç°

1. æŒ‰æ—¶é—´æ’åº
2. æœ€å¤§å †å †é¡¶å­˜å½“å‰æœ€å¤§é«˜åº¦
3. é‡åˆ°ç›¸åŒé«˜åº¦ç§»é™¤å †å†…åŒé«˜åº¦çš„å…ƒç´ 

åˆ é™¤ä¸­é—´ç»“ç‚¹åï¼Œ åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å­ç»“ç‚¹
å’Œrootå…ƒç´ å¯¹æ¯”ï¼Œå¦‚æœå¤§äºåˆ™å‘ä¸Šè°ƒæ•´ï¼Œå¦åˆ™å‘ä¸‹è°ƒæ•´
			if i < len(h.arr) {
				root := (i - 1) / 2
				if root >= 0 {
					if h.compare(i, root) {
						h.adjustDownToUp(i)
					} else {
						h.adjustUpToDown(i, len(h.arr))
					}
				}
			}
*/
/**
æ‰§è¡Œç”¨æ—¶åˆ†å¸ƒ
49
ms
å‡»è´¥
13.89%
å¤æ‚åº¦åˆ†æ
æ¶ˆè€—å†…å­˜åˆ†å¸ƒ
9.89
MB
å‡»è´¥
38.89%
å¤æ‚åº¦åˆ†æ

*/

type maxHeap struct {
	arr [][]int
}

func (h *maxHeap) Push(e []int) {
	h.arr = append(h.arr, e)
	h.adjustDownToUp(len(h.arr) - 1)
}

func (h *maxHeap) Remove(height int) {
	for i, event := range h.arr {
		if event[1] == height {
			h.arr[i], h.arr[len(h.arr)-1] = h.arr[len(h.arr)-1], h.arr[i]
			h.arr = h.arr[:len(h.arr)-1]
			if i < len(h.arr) {
				root := (i - 1) / 2
				if root >= 0 {
					if h.compare(i, root) {
						h.adjustDownToUp(i)
					} else {
						h.adjustUpToDown(i, len(h.arr))
					}
				}
			}
			return
		}
	}
}

func (h *maxHeap) adjustUpToDown(root, len int) {

	index := root*2 + 1
	for index < len {
		if index+1 < len && h.compare(index+1, index) {
			index++
		}
		if h.compare(index, root) {
			h.arr[index], h.arr[root] = h.arr[root], h.arr[index]
		} else {
			break
		}
		root = index
		index = root*2 + 1
	}
}

func (h *maxHeap) adjustDownToUp(index int) {
	root := (index - 1) / 2
	for root >= 0 {
		if h.compare(index, root) {
			h.arr[index], h.arr[root] = h.arr[root], h.arr[index]
		} else {
			break
		}
		index = root
		root = (index - 1) / 2
	}
}

func (h *maxHeap) compare(i, j int) bool {
	return h.arr[i][1] > h.arr[j][1]
}

func (h *maxHeap) Top() []int {
	if len(h.arr) == 0 {
		return []int{0, 0}
	}
	return h.arr[0]
}

func getSkyline(buildings [][]int) [][]int {

	//äº‹ä»¶
	events := make([][]int, len(buildings)*2)
	for i, b := range buildings {
		events[i*2] = []int{b[0], -b[2]}
		events[i*2+1] = []int{b[1], b[2]}
	}
	sort.Slice(events, func(i, j int) bool {
		return events[i][0] < events[j][0] || (events[i][0] == events[j][0] && events[i][1] < events[j][1])
	})
	var ans [][]int
	h := &maxHeap{}
	preHeight := 0
	for _, event := range events {
		if event[1] < 0 {
			h.Push([]int{event[0], -event[1]})
		} else {
			h.Remove(event[1])
		}
		if h.Top()[1] != preHeight {
			preHeight = h.Top()[1]
			ans = append(ans, []int{event[0], preHeight})
		}
	}
	return ans
}

func TestGetSkyline(t *testing.T) {

	fmt.Println(getSkyline([][]int{{2, 9, 10}, {3, 7, 15}, {5, 12, 12}, {15, 20, 10}, {19, 24, 8}}))
	fmt.Println(getSkyline([][]int{{0, 2, 3}, {2, 5, 3}}))
}
